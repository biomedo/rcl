;;Li Xuebai's .emacs

;;Ctrl+Spaceæ— æ•ˆ
(global-set-key (kbd "C-SPC")'nil)

;;ç”±äº outline-minor-mode çš„é”®ç»‘å®šå‰ç¼€ C-c @ è¿‡äºå¤æ‚ï¼Œ
;;å¤§éƒ¨åˆ†ç»å¸¸ä½¿ç”¨ outline çš„äººæƒ³æŠŠå®ƒè®¾ç½®ä¸ºå¦ä¸€ä¸ªé”®
(setq outline-minor-mode-prefix [(control o)])

;; æ”¹å˜ Emacs å›ºæ‰§çš„è¦ä½ å›ç­” yes çš„è¡Œä¸ºã€‚æŒ‰ y æˆ–ç©ºæ ¼é”®è¡¨ç¤º yesï¼Œn è¡¨ç¤º noã€‚
(fset 'yes-or-no-p 'y-or-n-p)

;;å…³é—­çƒ¦äººçš„å‡ºé”™æ—¶çš„æç¤ºå£°ã€‚
(setq visible-bell t)

;;å…³é—­èµ·åŠ¨æ—¶å€™çš„é‚£ä¸ªâ€œå¼€æœºç”»é¢â€
(setq inhibit-startup-message t)

;;æŸ¥æ‰¾æ—¶å€™ä¸¥æ ¼åŒºåˆ†å¤§å°å†™
(setq case-fold-search nil)

;;æ˜¾ç¤ºåˆ—å·
(setq column-number-mode t)

;;ä¸è¦åœ¨é¼ æ ‡ç‚¹å‡»çš„é‚£ä¸ªåœ°æ–¹æ’å…¥å‰ªè´´æ¿å†…å®¹ã€‚æˆ‘ä¸å–œæ¬¢é‚£æ ·ï¼Œ
;;ç»å¸¸æŠŠæˆ‘çš„æ–‡æ¡£æçš„ä¸€å›¢ç³Ÿã€‚æˆ‘è§‰å¾—å…ˆç”¨å…‰æ ‡å®šä½ï¼Œç„¶åé¼ æ ‡
;;ä¸­é”®ç‚¹å‡»è¦å¥½çš„å¤šã€‚ä¸ç®¡ä½ çš„å…‰æ ‡åœ¨æ–‡æ¡£çš„é‚£ä¸ªä½ç½®ï¼Œæˆ–æ˜¯åœ¨
;;minibufferï¼Œé¼ æ ‡ä¸­é”®ä¸€ç‚¹å‡»ï¼ŒX selection çš„å†…å®¹å°±è¢«æ’å…¥åˆ°é‚£ä¸ªä½ç½®ã€‚
(setq mouse-yank-at-point t)

;;ç”¨ä¸€ä¸ªå¾ˆå¤§çš„ kill ring. è¿™æ ·é˜²æ­¢ä¸å°å¿ƒåˆ æ‰é‡è¦çš„ä¸œè¥¿
(setq kill-ring-max 200)

;;æŠŠ fill-column è®¾ä¸º 60. è¿™æ ·çš„æ–‡å­—æ›´å¥½è¯»ã€‚
(setq default-fill-column 60)

;;ä¸ç”¨ TAB å­—ç¬¦æ¥indent, è¿™ä¼šå¼•èµ·å¾ˆå¤šå¥‡æ€ªçš„é”™è¯¯ã€‚ç¼–è¾‘ Makefile
;;çš„æ—¶å€™ä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œå› ä¸º makefile-mode ä¼šæŠŠ TAB é”®è®¾ç½®æˆçœŸæ­£çš„
;;TAB å­—ç¬¦ï¼Œå¹¶ä¸”åŠ äº®æ˜¾ç¤ºçš„ã€‚
;(setq-default indent-tabs-mode nil)
;(setq default-tab-width 8)
;(setq tab-stop-list ())
;(loop for x downfrom 40 to 1 do
;      (setq tab-stop-list (cons (* x 4) tab-stop-list)))

;;è®¾ç½® sentence-end å¯ä»¥è¯†åˆ«ä¸­æ–‡æ ‡ç‚¹ã€‚ä¸ç”¨åœ¨ fill æ—¶åœ¨å¥å·åæ’å…¥ä¸¤ä¸ªç©ºæ ¼ã€‚
(setq sentence-end "\\([ã€‚ï¼ï¼Ÿ]\\|â€¦â€¦\\|[.?!][]\"')}]*\\($\\|[ \t]\\)\\)[ \t\n]*")
(setq sentence-end-double-space nil)

;é˜²æ­¢é¡µé¢æ»šåŠ¨æ—¶è·³åŠ¨ï¼Œ scroll-margin 3 å¯ä»¥åœ¨é è¿‘å±å¹•è¾¹æ²¿3è¡Œæ—¶å°±å¼€å§‹æ»šåŠ¨ï¼Œ
;å¯ä»¥å¾ˆå¥½çš„çœ‹åˆ°ä¸Šä¸‹æ–‡ã€‚
(setq scroll-margin 3
      scroll-conservatively 10000)

;;æŠŠç¼ºçœçš„ major mode è®¾ç½®ä¸º text-mode, è€Œä¸æ˜¯å‡ ä¹ä»€ä¹ˆåŠŸèƒ½
;;ä¹Ÿæ²¡æœ‰çš„ fundamental-mode.
(setq default-major-mode 'text-mode)

;;æ‹¬å·åŒ¹é…æ—¶æ˜¾ç¤ºå¦å¤–ä¸€è¾¹çš„æ‹¬å·ï¼Œè€Œä¸æ˜¯çƒ¦äººçš„è·³åˆ°å¦ä¸€ä¸ªæ‹¬å·ã€‚
(show-paren-mode t)
(setq show-paren-style 'parentheses)

;;é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„æ‹¬å·ã€‚
(show-paren-mode 1)

;;å…‰æ ‡é è¿‘é¼ æ ‡æŒ‡é’ˆæ—¶ï¼Œè®©é¼ æ ‡æŒ‡é’ˆè‡ªåŠ¨è®©å¼€ï¼Œåˆ«æŒ¡ä½è§†çº¿ã€‚
(mouse-avoidance-mode 'animate)

;;æŒ‡é’ˆä¸é—ªï¼Œä¸æèŠ±çœ¼ç›ã€‚
(blink-cursor-mode -1)
(transient-mark-mode 1)

;;è®¾å®šå¥å­ç»“å°¾ï¼Œä¸»è¦é’ˆå¯¹ä¸­æ–‡è®¾ç½®
(setq sentence-end "\\([$(A!##!#?(B]\\|$(A!-!-(B\\|[.?!][]\"')}]*\\($\\|[ \t]\\)\\)[ \t\n]*")
(setq sentence-end-double-space nil)

;;ä½¿ç”¨aspellç¨‹åºä½œä¸ºemacsæ‹¼å†™æ£€æŸ¥ç¨‹åº
(setq-default ispell-program-name "aspell")

;;ä½¿ç”¨æœ¬åœ°å­—å…¸
(setq dictionary-server "localhost")

;;åœ¨æ ‡é¢˜æ æ˜¾ç¤ºbufferçš„åå­—ï¼Œè€Œä¸æ˜¯ emacs@email.***è¿™æ ·æ²¡ç”¨çš„æç¤ºã€‚
(setq frame-title-format "emacs@%b")

;;è®© Emacs å¯ä»¥ç›´æ¥æ‰“å¼€å’Œæ˜¾ç¤ºå›¾ç‰‡ã€‚
(auto-image-file-mode)

;;è¯­æ³•åŠ äº®
(global-font-lock-mode t)

;;è®¾ç½®æœ‰ç”¨çš„ä¸ªäººä¿¡æ¯.è¿™åœ¨è®¸å¤šåœ°æ–¹æœ‰ç”¨ã€‚
(setq user-full-name "Li Xuebai")
(setq user-mail-address "lixuebai@mail.ustc.edu.cn")

;;set background and forward color---------------
(setq default-frame-alist
      '(   (foreground-color . "Wheat")
           (background-color . "DarkSlateGray")
           (cursor-color     . "Orchid")
       ))

;;æ‰€æœ‰çš„å¤‡ä»½æ–‡ä»¶éƒ½æ”¾ç½®åœ¨~/backupsç›®å½•ä¸‹
(setq backup-directory-alist (quote (("." . "~/backups"))))
(setq version-control t)
(setq kept-old-versions 2)
(setq kept-new-versions 5)
(setq delete-old-versions t)
(setq backup-directory-alist '(("." . "~/backups")))
(setq backup-by-copying t)
;;emacsä¸­ï¼Œæ”¹å˜æ–‡ä»¶æ—¶ï¼Œé»˜è®¤éƒ½ä¼šäº§ç”Ÿå¤‡ä»½æ–‡ä»¶ï¼ˆä»¥~ç»“å°¾çš„æ–‡ä»¶ï¼‰ã€‚å¯ä»¥å®Œå…¨å»æ‰
;;ï¼ˆå¹¶ä¸å¯å–ï¼‰ï¼Œä¹Ÿå¯ä»¥åˆ¶å®šå¤‡ä»½çš„æ–¹å¼ã€‚è¿™é‡Œé‡‡ç”¨çš„æ˜¯ï¼ŒæŠŠæ‰€æœ‰çš„æ–‡ä»¶å¤‡ä»½éƒ½æ”¾åœ¨ä¸€ä¸ª
;;å›ºå®šçš„åœ°æ–¹ã€‚å¯¹äºæ¯ä¸ªå¤‡ä»½æ–‡ä»¶ï¼Œä¿ç•™æœ€åŸå§‹çš„ä¸¤ä¸ªç‰ˆæœ¬å’Œæœ€æ–°çš„äº”ä¸ªç‰ˆæœ¬ã€‚
;;å¹¶ä¸”å¤‡ä»½çš„æ—¶å€™ï¼Œå¤‡ä»½æ–‡ä»¶æ˜¯å¤ä»¶ï¼Œè€Œä¸æ˜¯åŸä»¶ã€‚

;;ä¸äº§ç”Ÿå¤‡ä»½æ–‡ä»¶
;(setq make-backup-files nil) 

;;è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œè¿™æ˜¯ä»ç‹å ä¸»é¡µç›´æ¥copyæ¥çš„ï¼Œå¼•ç”¨ä¸€äº›ä»–å¯¹æ­¤çš„è¯´æ˜ã€‚
;;ä½ å¯ä»¥è®¾ç½®ä»¥ä¸‹hippie-expandçš„è¡¥å…¨æ–¹å¼ã€‚å®ƒæ˜¯ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œ
;;hippie-expandä¼šä¼˜å…ˆä½¿ç”¨è¡¨æœ€å‰é¢çš„å‡½æ•°æ¥è¡¥å…¨ã€‚
;;è¿™æ˜¯è¯´ï¼Œé¦–å…ˆä½¿ç”¨å½“å‰çš„bufferè¡¥å…¨ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±åˆ°åˆ«çš„å¯è§çš„çª—å£é‡Œå¯»æ‰¾ï¼Œ
;;å¦‚æœè¿˜æ‰¾ä¸åˆ°ï¼Œé‚£ä¹ˆåˆ°æ‰€æœ‰æ‰“å¼€çš„bufferå»æ‰¾ï¼Œå¦‚æœè¿˜â€¦â€¦é‚£ä¹ˆåˆ°kill-ringé‡Œï¼Œ
;;åˆ°æ–‡ä»¶åï¼Œåˆ°ç®€ç§°åˆ—è¡¨é‡Œï¼Œåˆ°list......å½“å‰ä½¿ç”¨çš„åŒ¹é…æ–¹å¼ä¼šåœ¨echoåŒºåŸŸæ˜¾ç¤ºã€‚
;;ç‰¹åˆ«æœ‰æ„æ€çš„æ˜¯try-expand-lineï¼Œå®ƒå¯ä»¥å¸®ä½ è¡¥å…¨æ•´æ•´ä¸€è¡Œæ–‡å­—ã€‚æˆ‘å¾ˆå¤šæ—¶å€™æœ‰
;;ä¸¤è¡Œæ–‡å­—å¤§è‡´ç›¸åŒï¼Œåªæœ‰å‡ ä¸ªå­—ä¸ä¸€æ ·ï¼Œä½†æ˜¯æˆ‘æ‡’å¾—å»copy pasteä¸€ä¸‹ã€‚é‚£ä¹ˆæˆ‘å°±
;;è¾“å…¥è¿™è¡Œæ–‡å­—çš„å‰é¢å‡ ä¸ªå­—ã€‚ç„¶åå¤šæŒ‰å‡ ä¸‹M-/å°±èƒ½å¾—åˆ°é‚£ä¸€è¡Œã€‚
(global-set-key [(meta ?/)] 'hippie-expand)
(setq hippie-expand-try-functions-list
'(try-expand-line
  try-expand-line-all-buffers
  try-expand-list
  try-expand-list-all-buffers
  try-expand-dabbrev
  try-expand-dabbrev-visible
  try-expand-dabbrev-all-buffers
  try-expand-dabbrev-from-kill
  try-complete-file-name
  try-complete-file-name-partially
  try-complete-lisp-symbol
  try-complete-lisp-symbol-partially
  try-expand-whole-kill))

;;æ˜¾ç¤ºæ—¥æœŸ
(setq display-time-day-and-date t)
;;æ˜¾ç¤ºæ—¶é—´
(display-time)
;;æ—¶é—´ä¸º24å°æ—¶åˆ¶
(setq display-time-24hr-format t)
;;æ—¶é—´æ˜¾ç¤ºåŒ…æ‹¬æ—¥æœŸå’Œå…·ä½“æ—¶é—´
(setq display-time-day-and-date t)
;;æ—¶é—´æ æ—è¾¹å¯åŠ¨é‚®ä»¶è®¾ç½®
(setq display-time-use-mail-icon t)
;;æ—¶é—´çš„å˜åŒ–é¢‘ç‡
(setq display-time-interval 10)

;; è®¾ç½®æ—¶é—´æˆ³ï¼Œæ ‡è¯†å‡ºæœ€åä¸€æ¬¡ä¿å­˜æ–‡ä»¶çš„æ—¶é—´ã€‚
(setq time-stamp-active t)
(setq time-stamp-warn-inactive t)
(setq time-stamp-format "%:y-%02m-%02d %3a %02H:%02M:%02S K.T")

;; é»˜è®¤çš„æ—¥è®°æ–‡ä»¶
(setq diary-file "~/diary/rj")

;;è®¾ç½®æ‰€åœ¨åœ°çš„ç»çº¬åº¦å’Œåœ°åï¼Œcalendar å¯ä»¥æ ¹æ®è¿™äº›ä¿¡æ¯å‘ŠçŸ¥ä½ æ¯å¤©çš„
;;æ—¥å‡ºå’Œæ—¥è½çš„æ—¶é—´ã€‚
(setq calendar-latitude +31.8653)
(setq calendar-longitude +117.2797)
(setq calendar-location-name "Hefei")

;;èŠ‚æ—¥
(setq calendar-remove-frame-by-deleting t)
(setq calendar-week-start-day 1)
;;ä¸è¿‡åŸºç£æ•™çš„èŠ‚æ—¥
(setq christian-holidays nil)
;;ä¸è¿‡å¸Œä¼¯æ¥äººçš„èŠ‚æ—¥
(setq hebrew-holidays nil)
;;ä¸è¿‡ä¼Šæ–¯å…°æ•™çš„èŠ‚æ—¥
(setq islamic-holidays nil)
;;ä¸è¿‡å¤ªé˜³èŠ‚
(setq solar-holidays nil)
;;è¦è¿‡çš„èŠ‚æ—¥
(setq general-holidays '((holiday-fixed 1 1 "å…ƒæ—¦")
                         (holiday-fixed 5 1 "åŠ³åŠ¨èŠ‚")
                         (holiday-float 5 0 2 "æ¯äº²èŠ‚")
                         (holiday-float 6 0 3 "çˆ¶äº²èŠ‚")
                         (holiday-float 10 1 "å›½åº†èŠ‚")
                         (holiday-float 12 21 "æˆ‘çš„ç”Ÿæ—¥")))

;;æ—¥å†ä¸­çªå‡ºæ ‡è®°èŠ‚æ—¥å’Œç”Ÿæ—¥
(setq mark-holidays-in-calendar t)
;;æ‰“å¼€calendarè‡ªåŠ¨æ‰“å¼€èŠ‚æ—¥å’Œç”Ÿæ—¥åˆ—è¡¨
(setq view-calendar-holidays-initially t)

;; Calendar ä¸­ p C å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„é˜´å†æœ‰ä¸­æ–‡çš„å¤©å¹²åœ°æ”¯ã€‚
(setq mark-diary-entries-in-calendar t)
(setq appt-issue-message nil)
(setq mark-holidays-in-calendar nil)
(setq view-calendar-holidays-initially nil)

(setq chinese-calendar-celestial-stem
      ["ç”²" "ä¹™" "ä¸™" "ä¸" "æˆŠ" "å·±" "åºš" "è¾›" "å£¬" "ç™¸"])
(setq chinese-calendar-terrestrial-branch
      ["å­" "ä¸‘" "å¯…" "å¯" "è¾°" "å·³" "åˆ" "æœª" "ç”³" "é…‰" "æˆŒ" "äº¥"])

;; ä»£ç æŠ˜å 
(load-library "hideshow")
(add-hook 'java-mode-hook 'hs-minor-mode)
(add-hook 'perl-mode-hook 'hs-minor-mode)
(add-hook 'php-mode-hook 'hs-minor-mode)
(add-hook 'emacs-lisp-mode-hook 'hs-minor-mode)

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;AUCTeX 
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(load "auctex.el" nil t t)
(load "tex-site.el" nil t t)
(load "preview-latex.el" nil t t)

(setq TeX-electric-escape t)
(setq LaTeX-math-mode t)

(setq TeX-auto-save t)
(setq TeX-parse-self t)
(setq-default TeX-master nil)

(setq TeX-auto-untabify t) ;; ä¸ä½¿ç”¨ TABå­—ç¬¦ç¼©è¿›
(setq LaTeX-document-regexp "document\\|CJK\\*?")  ;; CJK ç¯å¢ƒä¸­ä¸ç¼©è¿›
(setq TeX-newline-function 'newline-and-indent) ;;å›è½¦æ—¶è‡ªåŠ¨ç¼©è¿›

(add-hook 'LaTeX-mode-hook #'LaTeX-install-toolbar)
(add-hook 'LaTeX-mode-hook 'turn-on-auto-fill)
(add-hook 'LaTeX-mode-hook 'turn-on-reftex)

(autoload 'LaTeX-preview-setup "preview")
(add-hook 'LaTeX-mode-hook #'LaTeX-preview-setup)

(autoload 'reftex-mode "reftex" "RefTeX Minor Mode" t)
(autoload 'turn-on-reftex "reftex" "RefTeX Minor Mode" nil)
(autoload 'reftex-citation "reftex-cite" "Make citation" nil)
(autoload 'reftex-index-phrase-mode "reftex-index" "Phrase mode" t)
(add-hook 'LaTeX-mode-hook 'turn-on-reftex)                        
(setq reftex-plug-into-AUCTeX t)

(setq reftex-revisit-to-follow t
      reftex-auto-recenter-toc t)
(add-hook 'TeX-mode-hook
          (lambda ()
            (setq reftex-plug-into-AUCTeX t)
            (turn-on-reftex)
            ))

;;æŠŠbeamerçš„frametitleä¹Ÿæ”¾å…¥reftexç›®å½•ç¼“å†²ä¸­ï¼Œä½†éœ€è¦æŠŠ\frametitleå†™åœ¨è¡Œé¦–
(setq reftex-section-levels
      '(("part" . 0) ("chapter" . 1) ("section" . 2) 
("subsection" . 3)
        ("frametitle" . 4) ("subsubsection" . 4) 
("paragraph" . 5)
        ("subparagraph" . 6) ("addchap" . -1) ("addsec" . -2)))

;;bibtexçš„è®¾ç½®
(setq bibtex-autokey-names 1
      bibtex-autokey-names-stretch 1
      bibtex-autokey-name-separator "-"
      bibtex-autokey-additional-names "-et.al."
      bibtex-autokey-name-case-convert 'identity
      bibtex-autokey-name-year-separator "-"
      bibtex-autokey-titlewords-stretch 0
      bibtex-autokey-titlewords 0
      bibtex-maintain-sorted-entries 'plain
      bibtex-entry-format '(opts-or-alts numerical-fields))

      
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;C/C++
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(add-hook 'c-mode-hook 'linux-c-mode)
(add-hook 'c++-mode-hook 'linux-cpp-mode)
;; è®¾ç½®imenuçš„æ’åºæ–¹å¼ä¸ºæŒ‰åç§°æ’åº
(setq imenu-sort-function 'imenu--sort-by-name)
(defun linux-c-mode()
;; å°†å›è½¦ä»£æ›¿C-jçš„åŠŸèƒ½ï¼Œæ¢è¡Œçš„åŒæ—¶å¯¹é½
  (define-key c-mode-map [return] 'newline-and-indent)
  (interactive)
;; è®¾ç½®Cç¨‹åºçš„å¯¹é½é£æ ¼
  (c-set-style "K&R")
;; è‡ªåŠ¨æ¨¡å¼ï¼Œåœ¨æ­¤ç§æ¨¡å¼ä¸‹å½“ä½ é”®å…¥{æ—¶ï¼Œä¼šè‡ªåŠ¨æ ¹æ®ä½ è®¾ç½®çš„å¯¹é½é£æ ¼å¯¹é½
  (c-toggle-auto-state)
;; æ­¤æ¨¡å¼ä¸‹ï¼Œå½“æŒ‰Backspaceæ—¶ä¼šåˆ é™¤æœ€å¤šçš„ç©ºæ ¼
  (c-toggle-hungry-state)
;; TABé”®çš„å®½åº¦è®¾ç½®ä¸º8
  (setq c-basic-offset 8)
;; åœ¨èœå•ä¸­åŠ å…¥å½“å‰Bufferçš„å‡½æ•°ç´¢å¼•
  (imenu-add-menubar-index)
;; åœ¨çŠ¶æ€æ¡ä¸Šæ˜¾ç¤ºå½“å‰å…‰æ ‡åœ¨å“ªä¸ªå‡½æ•°ä½“å†…éƒ¨
  (which-function-mode)
 )
(defun linux-cpp-mode()
  (define-key c++-mode-map [return] 'newline-and-indent)
  (define-key c++-mode-map [(control c) (c)] 'compile)
  (interactive)
  (c-set-style "K&R")
  (c-toggle-auto-state)
  (c-toggle-hungry-state)
  (setq c-basic-offset 8)
  (imenu-add-menubar-index)
  (which-function-mode)
  )


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;emms 
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(require 'emms)
(require 'emms-setup)
(require 'emms-player-mpg321-remote)
; use mpg321 to play, install mpg321 first

(defvar my-music-directory "~/music/")  
; directly play directory ~/music/

(emms-standard)
(emms-default-players)
(push 'emms-player-mpg321-remote emms-player-list)

(add-hook 'emms-player-started-hook 'emms-show) ; show the coming song
(setq emms-show-format "Now Playing: %s")
(setq emms-repeat-playlist t)                   ; repeat at the end

(global-set-key (kbd "<f6>") 'emms-play-default) ; one-key-to-play
(global-set-key (kbd "C->") 'emms-next)
(global-set-key (kbd "C-<") 'emms-previous)
(global-set-key (kbd "<pause>") 'emms-de-toggle-playing) 
; use pause key topause & resume
(global-set-key (kbd "<C-pause>") 'emms-stop) ; use ctrl-pause to stop
(global-set-key (kbd "<S-pause>") 'emms-playlist-mode-go) 
; use shift-pause tocheck playlist
(global-set-key (kbd "<C-S-pause>") 'emms-shuffle) 
; use ctrl-shift to shufflecurrent playlist

(defun emms-play-default ()             ; default play set
  (interactive)
  (emms-play-directory my-music-directory)
  (process-kill-without-query (get-process "emms-player-mpg321-remote-proc")))
                                        ; no pop window when exit

(defun emms-de-toggle-playing ()
  (interactive)
  (if emms-player-playing-p
      (emms-pause)
    (emms-start)))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;w3m w3m-elç›®å‰ä»…ä»…æ”¯æŒemacs21 è€Œé22
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;å¯åŠ¨å’Œåˆå§‹åŒ–w3m.el
(autoload 'w3m "w3m" "Interface for w3m on Emacs." t)
(autoload 'w3m-browse-url "w3m" "Ask a WWW browser to show a URL." t)
(autoload 'w3m-search "w3m-search" "Search words using emacs-w3m." t)
;;;ä½¿ç”¨å·¥å…·åŒ…
(setq w3m-use-toolbar t)
;;å¯ç”¨cookie
(setq w3m-use-cookies t)
;;è®¾å®šw3mè¿è¡Œçš„å‚æ•°ï¼Œåˆ†åˆ«ä¸ºä½¿ç”¨cookieå’Œä½¿ç”¨æ¡†æ¶
(setq w3m-command-arguments '("-cookie" "-F"))
;;ç”¨w3mæµè§ˆç½‘é¡µæ—¶ä¹Ÿæ˜¾ç¤ºå›¾ç‰‡
(setq w3m-display-inline-image t)
;;w3mæ˜¯ä½¿ç”¨tabçš„ï¼Œè®¾å®štabçš„å®½åº¦
(setq w3m-tab-width 8)
;;è®¾å®šw3mçš„ä¸»é¡µï¼ŒåŒmozilla firefoxçš„é»˜è®¤ä¸»é¡µä¸€æ ·ã€‚
(setq w3m-home-page "http://www.google.com")

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;emacs-wiki
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(require 'emacs-wiki)
(require 'emacs-wiki-menu)  ;ä½¿ç”¨å¯¼èˆªèœå•

(add-hook 'emacs-wiki-mode-hook
	    (lambda ()
             (define-key emacs-wiki-mode-map (kbd "C-c C-h") 'emacs-wiki-preview-html)
	     (define-key emacs-wiki-mode-map (kbd "C-c C-c") 'emacs-wiki-preview-source)
	     (define-key emacs-wiki-mode-map (kbd "C-c C-v") 'emacs-wiki-change-project)
             (define-key emacs-wiki-mode-map (kbd "C-c C-n") 'emacs-wiki-unlink-toggle)

))

;; (setq emacs-wiki-grep-command "glimpse -nyi \"%W\"")

;;è®¾ç½®wikié¡µé¢å­˜å‚¨çš„ç›®å½•
(setq emacs-wiki-directories '("~/wiki"))
;;è®¾ç½®å­˜å‚¨æºæ–‡ä»¶ä½¿ç”¨çš„é»˜è®¤çš„æ–‡å­—ç¼–ç 
(setq emacs-wiki-meta-charset "utf8")
;; è®¾ç½®å‘å¸ƒHTMLé¡µé¢ä½¿ç”¨çš„charsetï¼ˆå­—ç¬¦é›†ï¼‰ï¼Œ
(setq emacs-wiki-charset-default "utf8")
(setq emacs-wiki-style-sheet
      "")

;; è®¾ç½®ä½ çš„mailåœ°å€ï¼Œå®ƒå°†åšä¸ºä¸å­˜åœ¨é¡µé¢çš„é»˜è®¤é“¾æ¥åœ°å€
(setq emacs-wiki-maintainer "mailto:xuebaili@gmail.com")


;; å¯ç”¨changelogç¾åŒ–æ”¯æŒï¼Œä¸ºçœŸæ—¶ä¼šå°†changelogä¹Ÿå½“ä½œWikié¡µé¢å‘å¸ƒ
(setq emacs-wiki-pretty-changelogs t)

(setq emacs-wiki-inline-relative-to 'emacs-wiki-publishing-directory)

(defun emacs-wiki-preview-source ()
  (interactive)
  (emacs-wiki-publish-this-page)
  (find-file (emacs-wiki-published-file)))

(defun emacs-wiki-preview-html ()
  (interactive)
  (emacs-wiki-publish-this-page)
  (browse-url (emacs-wiki-published-file)))

(setq emacs-wiki-projects
`(("Default" . ((emacs-wiki-directories . ("~/wiki/source/Default"))
                (emacs-wiki-project-server-prefix . "../")
                (emacs-wiki-publishing-directory . "../../publish/Default")
                (emacs-wiki-default-page . "../Default/WelcomePage.html")))

  ("GNU" . ((emacs-wiki-directories . ("~/wiki/source/GNU"))
            (emacs-wiki-project-server-prefix . "../")
            (emacs-wiki-publishing-directory . "../../publish/GNU")
            (emacs-wiki-default-page . "../GNU/WelcomePage.html")))

  ("History" . ((emacs-wiki-directories . ("~/wiki/source/History"))
                (emacs-wiki-publishing-directory . "../../publish/History")
                (emacs-wiki-default-page . "../History/WelcomePage.html")))

  ("Music" . ((emacs-wiki-directories . ("~/wiki/source/Music"))
                (emacs-wiki-publishing-directory . "../../publish/Music")
                (emacs-wiki-default-page . "../Music/WelcomePage.html")))

  ("Fantasy" . ((emacs-wiki-directories . ("~/wiki/source/Fantasy"))
                (emacs-wiki-publishing-directory . "../../publish/Fantasy")
                (emacs-wiki-default-page . "../Fantasy/WelcomePage.html")))

  ("Others" . ((emacs-wiki-directories . ("~/wiki/source/Others"))
               (emacs-wiki-publishing-directory . "../../publish/Others")
               (emacs-wiki-default-page . "../Others/WelcomePage.html")))
))

;;css å¯ä»¥è®©ä½ çš„ç½‘é¡µä¸é‚£ä¹ˆå‘†æ¿
(setq emacs-wiki-style-sheet
      "<link rel=\"stylesheet\" type=\"text/css\" href=\"core.css\">")

;;è®¾å®šèœå•çš„ç”Ÿæˆæ–¹å¼ï¼Œæ¯”è¾ƒå¥½ç”¨çš„ç”Ÿæˆæ–¹å¼æ˜¯è‡ªå·±è®¾å®šå¯¼èˆªèœå•é¡¹ï¼Œä¸‹é¢æ˜¯æˆ‘çš„å¯¼èˆªèœå•è®¾ç½®.
(setq emacs-wiki-menu-factory 'emacs-wiki-menu-make-from-list)
(setq emacs-wiki-menu-definition '(("Default" "../Default/WelcomePage.html" "")
                                   ("GNU" "../GNU/WelcomePage.html" "")
                                   ("History" "../History/WelcomePage.html" "")
                                   ("Music" "../Music/WelcomePage.html" "")
                                   ("Fantasy" "../Fantasy/WelcomePage.html" "")
                                   ("Others" "../Others/WelcomePage.html" "")))


;;è¦åœ¨å¤šä¸ªé¡¹ç›®ä¹‹é—´ç›¸äº’å¼•ç”¨ï¼Œé¦–å…ˆè¦è®¾ç½® emacs-wiki-inter-names
(setq emacs-wiki-interwiki-names
      '(("Default" .
         (lambda (tag)
           (concat "../Default/" tag ".html")))
        ("GNU" .
         (lambda (tag)
           (concat "../GNU/" tag ".html")))
        ("History" .
         (lambda (tag)
           (concat "../History/" tag ".html")))
        ("Music" .
         (lambda (tag)
           (concat "../Music/" tag ".html")))
        ("Fantasy" .
         (lambda (tag)
           (concat "../Fantasy/" tag ".html")))
        ("Others" .
         (lambda (tag)
           (concat "../Others/" tag ".html")))))

;; è‡ªå®šä¹‰å‡½æ•°emacs-wiki-unline-toggleï¼Œç”¨äºè‡ªåŠ¨å¯¹WikiNameæ·»åŠ /åˆ é™¤<nop>æ ‡è®°
;;{{{ copy from yason@emacswiki, modified by Yu Li
(defun emacs-wiki-unlink-toggle ()
  "Toggle <nop> string in the beginning of the current word, to
un/make a word emacs-wiki link. The current word depends on the
point: if the cursor is on a non-whitespace character, it's
considered a word surrounded by whitespace. If the cursor is on a
whitespace character, the next word is looked up. This way
addressing a word works intuitively after having arrived on the
spot using forward-word."
  (interactive)
  (save-excursion
    (with-current-buffer (current-buffer)
    (if (looking-at "[ \t]")
        (goto-char (- (re-search-forward "[A-Za-z<>]") 1))
      (goto-char (+ (re-search-backward "[^A-za-z<>]") 1)))
    (if (looking-at "<nop>")
        (delete-char 5)
      (insert "<nop>")))))
;;}}}

;;åœ¨ä¿å­˜çš„æ—¶å€™è‡ªåŠ¨å‘å¸ƒä¸ºhtmlæ–‡ä»¶ï¼Œå¾ˆçœäº‹ï¼Œè¿™æ˜¯Sachaçš„ä»£ç ï¼š
;;;_+ Automatically publish files upon saving
 (defun sacha-emacs-wiki-auto-publish ()
   (when (derived-mode-p 'emacs-wiki-mode)
     (unless emacs-wiki-publishing-p
       (let ((emacs-wiki-publishing-p t)
             (emacs-wiki-after-wiki-publish-hook nil))
    (emacs-wiki-publish-this-page)))))
 (add-hook 'emacs-wiki-mode-hook
           (lambda () (add-hook 'after-save-hook
                                'sacha-emacs-wiki-auto-publish
                                nil t)))

;; ç”¨äºæ˜¾ç¤ºå…¬å¼
;(load "latex2png.el")
;(push '("latex" t t t gs-latex-tag) emacs-wiki-markup-tags)
;(setq gs-latex2png-scale-factor 1.5)

;; è®¾ç½®é¢„è§ˆæ‰€ç”¨çš„WWWæµè§ˆå™¨ï¼Œæˆ‘ä½¿ç”¨çš„firefoxï¼Œè¯·æŠŠå®ƒæ”¹ä¸ºä½ ä½¿ç”¨çš„æµè§ˆå™¨çš„åå­—
(setq browse-url-generic-program "firefox")

;;header
(setq emacs-wiki-publishing-header "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.0 Transitional//EN\">
<html>
  <head>
    <title><lisp>(emacs-wiki-page-title)</lisp></title>
    <meta name=\"generator\" content=\"emacs-wiki.el\" />
    <meta http-equiv=\"<lisp>emacs-wiki-meta-http-equiv</lisp>\"
          content=\"<lisp>emacs-wiki-meta-content</lisp>\" />
    <link rel=\"made\" href=\"<lisp>emacs-wiki-maintainer</lisp>\" />
    <link rel=\"home\" href=\"<lisp>(emacs-wiki-published-name
                                     emacs-wiki-default-page)</lisp>\" />
    <link rel=\"index\" href=\"<lisp>(emacs-wiki-published-name
                                      emacs-wiki-index-page)</lisp>\" />
    <lisp>emacs-wiki-style-sheet</lisp>
  </head>
  <body>

    <!-- If you want a menu, uncomment the following lines and
    put (require 'emacs-wiki-menu) in your Emacs setup somewhere.
     -->
    <lisp>(when (boundp 'emacs-wiki-menu-factory)
            (funcall emacs-wiki-menu-factory))</lisp>
    

    <h1 id=\"top\"><lisp>(emacs-wiki-page-title)</lisp></h1>

    <!-- Page published by Emacs Wiki begins here -->
")

;;footer
(setq emacs-wiki-publishing-footer
  "
    <!-- Page published by Emacs Wiki ends here -->
    <div class=\"navfoot\">
      <hr />
      <table width=\"100%\" border=\"0\" summary=\"Footer navigation\">
        <col width=\"33%\" /><col width=\"34%\" /><col width=\"33%\" />
        <tr>
          <td align=\"left\">
            <lisp>
              (if buffer-file-name
                  (concat
                   \"<span class=\\\"footdate\\\">Updated: \"
                   (format-time-string emacs-wiki-footer-date-format
                    (nth 5 (file-attributes buffer-file-name)))
                   (and emacs-wiki-serving-p
                        (emacs-wiki-editable-p (emacs-wiki-page-name))
                        (concat
                         \" / \"
                         (emacs-wiki-link-href
                          (concat \"editwiki?\" (emacs-wiki-page-name))
                          \"Edit\")))
                   \"</span>\"))
            </lisp>
          </td>
          <td align=\"center\">
            <span class=\"foothome\">
              <lisp>
                (concat
                 (and (emacs-wiki-page-file emacs-wiki-default-page t)
                      (not (emacs-wiki-private-p emacs-wiki-default-page))
                      (concat
                       (emacs-wiki-link-href emacs-wiki-default-page \"Home\")
                       \" / \"))
                 (emacs-wiki-link-href emacs-wiki-index-page \"Index\")
                 (and (emacs-wiki-page-file \"ChangeLog\" t)
                      (not (emacs-wiki-private-p \"ChangeLog\"))
                      (concat
                       \" / \"
                       (emacs-wiki-link-href \"ChangeLog\" \"Changes\"))))
              </lisp>
            </span>
          </td>
          <td align=\"right\">
            <lisp>
              (if emacs-wiki-serving-p
                  (concat
                   \"<span class=\\\"footfeed\\\">\"
                   (emacs-wiki-link-href \"searchwiki?get\" \"Search\")
                   (and buffer-file-name
                        (concat
                         \" / \"
                         (emacs-wiki-link-href
                          (concat \"searchwiki?q=\" (emacs-wiki-page-name))
                          \"Referrers\")))
                   \"</span>\"))
            </lisp>
          </td>
        </tr>
      </table>
    </div>
  </body>
</html>\n"
)

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;gnus
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(setq gnus-default-charset 'UTF-8)

;(add-to-list 'gnusq-group-charset-alist
;        '("\\(^\\|:\\)cn\\>\\|\\<chinese\\>" gbk))

;;è®¾å®šæ–°é—»ç»„æœåŠ¡å™¨
(setq gnus-select-method '(nntp "news.cn99.com"))

;;è®¢é˜…æ–°é—»ç»„
(setq gnus-default-subscribed-newsgroups
  '("gnu.emacs.help"     ;; è¿™é‡Œä¸é”™å™¢ï¼Œæœ‰å…³emacsä½¿ç”¨çš„é—®é¢˜éƒ½åœ¨è¿™é‡Œè®¨è®º
    "cn.comp.os.linux")) ;; è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªemacså°å›¢ä¼™ï¼Œ
                         ;; æœ‰ç©ºå»å‡‘ä¸ªçƒ­é—¹å§ï¼Œä¸­æ–‡çš„å“Ÿ

(setq mail-sources
      '((pop :server "pop.sina.com"   ;; åœ¨è¿™é‡Œè®¾ç½®pop3æœåŠ¡å™¨
             :user "heidegger@sina.com"            ;; ç”¨æˆ·å
             :port "pop3"
             :password "lixuebai"))) ;; å¯†ç 

;;å¦‚ä½•å­˜æ”¾mail
(setq gnus-secondary-select-methods '((nnfolder "")))

;;send mail
(setq user-full-name "heidegger") ;; å¤–å‘çš„é‚®ä»¶é‡‡ç”¨è¿™ä¸ªåå­—
(setq user-mail-address "heidegger@sina.com") ;;å¤–å‘çš„é‚®ä»¶é‡‡ç”¨è¿™ä¸ªåœ°å€
(setq smtpmail-auth-credentials
    '(("smtp.sina.com"  ;; SMTPæœåŠ¡å™¨
       25
       "heidegger"          ;; ç”¨æˆ·å
       "lixuebai")))   ;; å¯†ç 
(setq smtpmail-default-smtp-server "smtp.sina.com")
(setq smtpmail-smtp-server "smtp.sina.com")
(setq message-send-mail-function 'smtpmail-send-it)

;;å­˜å‚¨å¤–å‘é‚®ä»¶
(setq gnus-message-archive-group
      '((if (message-news-p)
            "nnfolder:mail.sent.news"
          "nnfolder:mail.sent.mail")))

;;htmlé™„ä»¶
(eval-after-load "mm-decode"
  '(progn
     (add-to-list 'mm-discouraged-alternatives "text/html")
     (add-to-list 'mm-discouraged-alternatives "text/richtext")))

(setq gnus-default-charset 'chinese-iso-8bit
   gnus-group-name-charset-group-alist '((".*" . chinese-iso-8bit))
   gnus-summary-show-article-charset-alist
       '((1 . utf-8)
         (2 . gbk)
         (3 . big5)
         (4 . utf-7))
   gnus-group-name-charset-group-alist
      '(("\\.com\\.cn:" . utf-8)
        ("news\\.newsfan\\.net" . gbk))
   gnus-group-name-charset-method-alist
      '(((nntp "news.newsfan.net") . utf-8))
   gnus-newsgroup-ignored-charsets
       '(unknown-8bit x-unknown iso-8859-1))

;;attach as rfc2047 or not rfc2231 which is default.
(defalias 'mail-header-encode-parameter 'rfc2047-encode-parameter)
;(add-to-list 'rfc2047-charset-encoding-alist '(gbk . B))
;(add-to-list 'rfc2047-charset-encoding-alist '(gb18030 . B))

;;è®¾ç½®å‘å‡ºé‚®ä»¶çš„ç¼–ç 
(setq gnus-posting-styles
      '((".*"
         (name "heidegger")
         (address "heidegger@sina.com")
         (eval (setq mm-coding-system-priorities
                     '(iso-8859-1 gb2312 utf-8))))
        ("^tw\\.comp"
         (name "xx")
         (address "xx@ptt.cc")
         (eval (setq mm-coding-system-priorities
                     '(iso-8859-1 big5 utf-8)))))
       )

;;è®© Gnus æŠŠContent-Typeå’ŒContent-Transfer-Encodingå­—æ®µæ˜¾ç¤ºå‡ºæ¥
(add-hook 'gnus-startup-hook
          '(lambda ()
             (setq gnus-visible-headers
                   (concat "^User-Agent:\\|^Content-Type:\\|"
                           "Content-Transfer-Encoding:\\|"
                           "^X-mailer:\\|^X-Newsreader:\\|^X-Sender:\\|"
                           gnus-visible-headers))))

;;è‡ªåŠ¨æŠ˜è¡Œ
(add-hook 'gnus-article-prepare-hook
           (lambda ()
             (setq fill-column 80)
             (gnus-article-fill-long-lines)))

;;å°†é‚®ä»¶çš„å‘å‡ºæ—¶é—´è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´
(add-hook 'gnus-article-prepare-hook 'gnus-article-date-local)

;;å½“ä½ æŒ‰ä¸‹å‘é€é‚®ä»¶çš„ç»„åˆé”®æ—¶ï¼Œgnuså°±ä¼šè¦æ±‚ä½ ç¡®è®¤ï¼Œ
;;å½“ä½ å›ç­”â€œyesâ€æ—¶æ‰ä¼šå‘é€é‚®ä»¶ï¼Œå¦‚æœå›ç­”â€œnoâ€å°†å–æ¶ˆå‘é€ã€‚
(defadvice message-send (around my-confirm-message-send)
   (if (yes-or-no-p "Really send message? ")
       ad-do-it))
(ad-activate 'message-send)

;;å°†é‚®ä»¶æŒ‰æœˆåˆ†ç»„,æš‚æ—¶ä¸ç”¨ã€‚
;(defun date (u)
;   (concat (format-time-string "%Y-%m." (current-time)) u))
; 
;(setq nnmail-split-fancy
;       `(| (to "localhost" "mail.system")
;           (to "myname@sohu.com" "mail.sohu")
;           (to "emacs-devel@gnu.org" ,(date "emacs-devel"))
;           "mail.misc"))
; 
;(setq nnmail-split-methods 'nnmail-split-fancy)
